# 3. WMTS图层

## 3.1 配置及切图

工程浩大，实验中，暂略。

如有需要请购买正版地图，否则安心用互联网底图多好。

## 3.2 下载已有的WMTS地图

TileCache? Geowebcache? 将来或许会用，现在还是用点简单东西吧。WMTS说白了还是XYZ，所以，

``https://github.com/brandonxiang/pyMap.git``

安装python3，以及一堆依赖库，然后安装Pillow，嗯，差不多了就。

推荐修改下代码，让命令行模式生效，简单的替换下``pyMap.py``最末尾的注释就可以了：
```python
if __name__ == '__main__':
    # config()
    # test()
    cml()
```

然后就是开始缓存，推荐在Linux系统下进行，写个.sh批量后台执行（命令行末尾加上 ``&``即可）。
根据``pyMap``的实现以及Web墨卡托地图的性质，一般国内使用可以这样下载：

+ 0到8级世界地图

坐标范围(pyMap参数顺序)：

```
python3 pyMap.py 88 -179.999999999999 -88 179.999999999 级别 存储路径 地图路径或代码 &
```

+ 9到12级中国地图

```
python3 pyMap.py 54 73 3 136 9 级别 存储路径 地图路径或代码 &
```

+ 以及，需要使用的城市的13到18级地图。

至于是否要分片抓取提高速度、进程多少可以起到最佳效果并且不会被封IP，这些取决于你的需求和配置及网络。如果没有必要，可以将图片拼接代码注释掉，可以节约不少时间。当然愿意修改代码使之自动存储到合适的路径不来回覆盖的话请@我，我很懒就不管那个了。
<center>友情提示</center>

    没事不要尝试下载或制作全球的全套瓦片。12级瓦片中国地区就有60万个，人家说切一次图要一个月倒真不算夸张了。
    实际上，访问量不是极大时，难道不该考虑用容易更新、支持样式函数、绿色环保占地少的WFS吗？

## 3.3 发布XYZ为WMTS

只能说github真实不错，你想到的都勉强能找到相关的工程。

``https://github.com/eyeNsky/tiles2wmts.git``

只需要在``tiles.json``里面写好xyz的访问参数，然后用``genCapabilities.py``生成描述文件``WMTSGetCapabilities.xml``就可以了。我是放在tomcat里发布的，至于xyz的URL是否支持本地文件形式没有尝试，有兴趣的可以试试看。

``QGIS``里加载WMTS时，只需要打开这个描述文件就可以了。

至于是否有必要用ol加载这种WMTS，我自己是抗拒的。既然有xyz的地址，何苦费力气去测试能用的WMTS地址。当然如果有人弄清楚了，请@我，我很懒，但是有求知欲。


## 3.4 ol加载WMTS图层

``http://openlayers.org/en/latest/examples/wmts.html``

不用我多说了吧，代码长长的。我还是喜欢xyz，只要和谷歌瓦片兼容，一切都是一路畅通~
